# Smart Vote - Syst√®me de Vote D√©centralis√© sur Blockchain

## R√©partition des r√¥les et contributions

Membre 1 ‚Äî Cheffe de projet / Coordinatrice: Nour BEN REJEB  
Membre 2 ‚Äî Analyste / Sp√©cifications: Harouna BA  
Membre 3 ‚Äî Architecte Smart Contract: Rostom MOUADDEB  
Membre 4 ‚Äî D√©veloppeur¬∑se Solidity: Souleymane  
Membre 5 ‚Äî Testeur¬∑se Smart Contract: Salamata Nourou MBAYE  
Membre 6 ‚Äî D√©ploiement / Environnement de test: Dixy Prevner M POUTOU BABINGUI  
Membre 7 ‚Äî D√©veloppeur¬∑se Frontend (interface simple): El Hadji Mamadou SARR  
Membre 8 ‚Äî Int√©gration web3 / Connexion au contrat: Thierno Sadou BARRY  
Membre 9 ‚Äî Documentation & Guides: Ala TROJETTE  
Membre 10 ‚Äî QA finale, simulation et captures: Basak DURGUN DONMEZ

---

## üìã Table des Mati√®res

* [√Ä propos](#√†-propos)
* [Fonctionnalit√©s](#fonctionnalit√©s)
* [Architecture](#architecture)
* [Installation](#installation)
* [Guide d'utilisation](#guide-dutilisation)
* [D√©ploiement](#d√©ploiement)
* [Tests](#tests)
* [Captures d'√©cran](#captures-d√©cran)
* [Architecture du Smart Contract de Vote](#architecture-du-smart-contract-de-vote)
* [Contact](#contact)

## √Ä propos

**Smart Vote** est une application de vote d√©centralis√©e construite sur Ethereum qui permet d'organiser des √©lections transparentes et s√©curis√©es. Le syst√®me utilise des smart contracts pour garantir l'int√©grit√© des votes et la transparence du processus √©lectoral.

### Objectifs principaux

* Permettre aux √©lecteurs de voter une seule fois
* Garantir la s√©curit√© et la visibilit√© des r√©sultats
* Cr√©er un syst√®me transparent et auditable

### Stack Technique

* **Blockchain**: Ethereum (Solidity)
* **Frontend**: HTML5, CSS3, JavaScript (Web3.js)
* **Tests**: Truffle, Mocha
* **D√©ploiement**: Truffle

## Fonctionnalit√©s

‚úÖ **S√©curit√© renforc√©e** ‚Äî Protection contre le double vote
‚úÖ **Transparence** ‚Äî Tous les votes sont enregistr√©s sur la blockchain
‚úÖ **Accessibilit√©** ‚Äî Interface web intuitive
‚úÖ **Auditabilit√©** ‚Äî Historique complet des transactions
‚úÖ **Administration** ‚Äî Gestion compl√®te du scrutin par l'administrateur
‚úÖ **Comptabilisation automatique** ‚Äî Les votes sont compt√©s automatiquement par le smart contract

## Architecture

### Vue d'ensemble

Le syst√®me Smart Vote est compos√© de trois composants principaux :

1. **Smart Contract** (Solidity) ‚Äî Logique de vote et enregistrement sur blockchain
2. **Interface Web** (HTML/CSS/JavaScript) ‚Äî Interaction utilisateur
3. **Tests automatis√©s** ‚Äî Validation du fonctionnement

> Pour le d√©tail complet de l‚Äôarchitecture bas-niveau du contrat, voir [Architecture du Smart Contract de Vote](#architecture-du-smart-contract-de-vote).

## Installation

### Pr√©requis

* Node.js (v14 ou sup√©rieur)
* npm ou yarn
* MetaMask (extension navigateur)
* Truffle (global)
* Ganache (pour le d√©veloppement local)

### Installation locale

1. **Cloner le repository**

```bash
git clone https://github.com/el-hadji-mamadou-sarr/smart-vote.git
cd smart-vote
```

2. **Installer les d√©pendances**

```bash
npm install
npm install -g truffle
```

3. **Configurer l'environnement**

```bash
# Pour le d√©veloppement local
# D√©marrer la blockchain locale sur 127.0.0.1:8545 avec 10 comptes pr√©financ√©s
ganache
```

- Mettre l'adresse des participants dans contrats/simple-voting.sol

4. **Compiler et d√©ployer les contrats**

```bash
truffle compile
truffle migrate --reset
```
- Mettre l'adresse du contrat dans app.js

5. **Lancer l'application**

```bash
npm run dev
``` 

## Guide d'utilisation

### Pour les administrateurs

#### 1. Configuration initiale

```javascript
// Se connecter √† MetaMask et s√©lectionner le compte administrateur
// D√©ployer le contrat ou utiliser l'adresse du contrat d√©ploy√©
```

#### 2. Ajouter des candidats

```javascript
// Ajouter des candidats (phase Setup uniquement)
await contract.methods.addCandidate("Amadou").send({ from: adminAddress });
await contract.methods.addCandidate("Demba").send({ from: adminAddress });
await contract.methods.addCandidate("Omar").send({ from: adminAddress });
```

#### 3. Ouverture du scrutin

```javascript
// Ouvrir les votes
await contract.methods.openVoting().send({ from: adminAddress });
```

#### 4. Cl√¥ture du scrutin

```javascript
// Fermer les votes
await contract.methods.closeVoting().send({ from: adminAddress });
```

### Pour les √©lecteurs

#### 1. Se connecter

* Ouvrir l'application dans le navigateur
* Connecter MetaMask au r√©seau appropri√©
* S√©lectionner le compte de vote

#### 2. Voter

```javascript
// V√©rifier si l'utilisateur peut voter
const hasVoted = await contract.methods.hasVoted(userAddress).call();

// Voter pour un candidat
await contract.methods.vote(candidateId).send({ from: userAddress });
```

#### 3. Consulter les r√©sultats

```javascript
// Obtenir les r√©sultats
const results = await contract.methods.getVotes().call();
const winner = await contract.methods.winningCandidate().call();
```

## D√©ploiement

### D√©ploiement sur testnet (Rinkeby/Ropsten)

1. **Obtenir des ETH de test**

   * Utiliser un faucet ([https://faucets.chain.link/](https://faucets.chain.link/))

2. **Configurer le fichier de configuration**

```javascript
// truffle-config.js
module.exports = {
  networks: {
    rinkeby: {
      provider: () =>
        new HDWalletProvider(
          mnemonic,
          `https://rinkeby.infura.io/v3/YOUR_PROJECT_ID`
        ),
      network_id: 4,
      gas: 5650000,
      confirmations: 2,
      timeoutBlocks: 200,
      skipDryRun: true,
    },
  },
};
```

3. **D√©ployer**

```bash
truffle migrate --network rinkeby
```

### D√©ploiement sur mainnet

‚ö†Ô∏è **Attention** : Le d√©ploiement sur mainnet n√©cessite des ETH r√©els et une revue de s√©curit√© approfondie.

```bash
truffle migrate --network mainnet
```

## Tests


### Pr√©paration

* **D√©marrer Ganache**

```bash
ganache-cli
```

* Le serveur RPC tourne sur `127.0.0.1:8545` avec 10 comptes √† \~1000 ETH. *(Pic 1)*

* **Compiler**

```bash
truffle compile
```

* Compilation r√©ussie ; artifacts g√©n√©r√©s dans `build/contracts`. *(Pic 2)*

* **D√©ployer**

```bash
truffle migrate --reset
```

* Exemple de sortie (local) :
  Adresse du contrat : `0xA36Db62B0De385f5715178b9f74Ad91b2a891B9f`
  Compte d√©ployeur : `0xF6C3508Ff8d5f9433E3E63B9DC8996B0baC4a5a1`
  Co√ªt \~0.0059 ETH (Ganache). *(Pic 3)*

### Lancer les tests

```bash
truffle test
# avec couverture (si configur√©)
truffle run coverage
```

* **VotingSystem.test.js** *(Pic 4)*

  * ‚úÖ D√©ploiement : contrat d√©ploy√©, propri√©taire d√©fini, candidats initialis√©s.
  * ‚úÖ Phases : seul le propri√©taire peut ouvrir/fermer.
  * ‚úÖ Vote : pr√©vention double vote, rejet indices invalides, comptage correct.
  * ‚úÖ R√©sultats : `getVotes()` exact, `winningCandidate()` coh√©rent.
  * ‚úÖ Cas limites : votes simultan√©s OK, lecture apr√®s fermeture, vote bloqu√© apr√®s fermeture.

* **FailureCases.test.js** *(Pic 5)*

  * ‚úÖ S√©curit√© / acc√®s : op√©rations admin interdites aux non-propri√©taires.
  * ‚úÖ Anti-double-vote : toute 2e tentative √©choue.
  * ‚úÖ Entr√©es invalides : candidats inexistants rejet√©s.
  * ‚úÖ Phases : impossible de voter avant ouverture / apr√®s fermeture.
  * ‚úÖ Stress : rejets syst√©matiques des votes multiples simultan√©s depuis la m√™me adresse.

### Reproduction cibl√©e

```bash
truffle test test/VotingSystem.test.js --grep "should allow voting"
truffle test test/FailureCases.test.js --grep "should prevent double voting"
truffle test test/VotingSystem.test.js --grep "should calculate winner correctly"
```

### Versions utilis√©es

<img width="800" height="175" alt="image" src="https://github.com/user-attachments/assets/658c42af-29be-437d-a0f9-1eea6a69463c" />


## Captures d'√©cran

* **Pic 1** ‚Äî D√©marrage de Ganache / comptes : <img width="1056" height="691" alt="image" src="https://github.com/user-attachments/assets/65b965c0-27a9-4260-ae86-cbd34bfbc5c3" />


* **Pic 2** ‚Äî Compilation Truffle r√©ussie : <img width="1025" height="529" alt="image" src="https://github.com/user-attachments/assets/f3cee6cd-c656-4b1c-98a2-561570fe1f12" />

* **Pic 3** ‚Äî D√©ploiement & adresse du contrat : <img width="1025" height="529" alt="image" src="https://github.com/user-attachments/assets/1fe7551e-ae00-4eb9-877c-783e1f8f554e" />


* **Pic 4** ‚Äî R√©sultats `VotingSystem.test.js` : <img width="1035" height="318" alt="image" src="https://github.com/user-attachments/assets/51d96f3e-55ab-4e57-93aa-9b58f0b6e911" />

* **Pic 5** ‚Äî R√©sultats `FailureCases.test.js` : <img width="1041" height="548" alt="image" src="https://github.com/user-attachments/assets/a0d0af51-9c4b-4f7b-ac42-996ce8b1cd09" />

* **Pic 6** ‚Äî Logs de test additionnels :   <img width="650" height="650" alt="image" src="https://github.com/user-attachments/assets/6245b663-7e90-4a2f-bbd1-97ccce78870b" />  

* **Pic 7** ‚Äî Logs/console utiles :  <img width="650" height="650" alt="image" src="https://github.com/user-attachments/assets/a9e1a0e6-2742-4ffd-b3a8-1e9d7aa13e12" />  

* **Pic 8** ‚Äî √âtat des comptes/transactions :   <img width="650" height="650" alt="image" src="https://github.com/user-attachments/assets/21554862-9bad-4e0a-8966-8cb0b9ad5172" />  

* **Pic 9** ‚Äî Autre sortie tests :   <img width="650" height="650" alt="image" src="https://github.com/user-attachments/assets/06c651ee-8f69-499d-83d0-a876e8ef8425" />  

* **Pic 10** ‚Äî Autre sortie tests :   <img width="650" height="650" alt="image" src="https://github.com/user-attachments/assets/63c1caa5-742d-4336-8d08-2aaf5197d174" />  

* **Pic 11** ‚Äî Autre sortie tests :   <img width="650" height="600" alt="image" src="https://github.com/user-attachments/assets/f2a0fc9b-8138-472a-a9db-951b8f7e80ec" />  

* **Pic 12** ‚Äî Autre sortie tests :   <img width="650" height="650" alt="image" src="https://github.com/user-attachments/assets/96a1c67b-6ed4-4404-9372-263df277c803" />  


### Placeholder Frontend

* **Pic Frontend** ‚Äî Capture de l‚Äôinterface (Formulaire vote / r√©sultats) : 
<img width="550" height="1090" alt="image" src="https://github.com/user-attachments/assets/12f9c8a4-2d1a-42e9-abd4-24be9ff50621" />  
<img width="550" height="890" alt="image" src="https://github.com/user-attachments/assets/be645a85-a2a6-44c5-a076-57da04a614ac" />  
<img width="550" height="890" alt="image" src="https://github.com/user-attachments/assets/8e2411c1-6dad-4161-b631-d06b190fb319" />  
<img width="550" height="890" alt="image" src="https://github.com/user-attachments/assets/1b671bc2-d359-47a0-969f-767b1d82b882" />  





---

## Architecture du Smart Contract de Vote

### Mod√®le de donn√©es

#### Candidate
- **id**: `uint256` ‚Äî identifiant unique du candidat  
- **name**: `string` ‚Äî nom du candidat  
- **votes**: `uint256` ‚Äî nombre de voix re√ßues  

#### Structures globales
- **candidates**: `Candidate[]`  
  Tableau index√© par `id` contenant tous les candidats.  

- **hasVoted**: `mapping(address => bool)`  
  Enregistre si une adresse a d√©j√† vot√© (**anti-double-vote strict**).  

- **voteOf**: `mapping(address => uint256)`  
  Trace publique du choix de chaque adresse (utile pour audit et transparence).  
  > üí° Pour pr√©server l‚Äôanonymat, une √©volution possible serait un syst√®me **commit-reveal** (v2).  

- **owner**: `address`  
  Adresse propri√©taire du contrat (r√¥le administrateur).  

- **phase**: `enum { Setup, Voting, Ended }`  
  Indique l‚Äô√©tat courant du scrutin : configuration, en cours, ou termin√©.  

---

### √âv√©nements

- **CandidateAdded(uint256 id, string name)** : ajout d‚Äôun candidat  
- **VotingOpened(uint256 at)** : ouverture officielle du scrutin  
- **VotingClosed(uint256 at)** : cl√¥ture du scrutin  
- **VoteCast(address voter, uint256 candidateId, uint256 newCount)** : enregistrement d‚Äôun vote  

---

### Acc√®s et modificateurs

- **onlyOwner** : r√©serv√© aux op√©rations d‚Äôadministration (ajout de candidat, ouverture, fermeture)  
- **inPhase(Phase)** : assure que les appels respectent le cycle du scrutin  

---

### Fonctions publiques

#### Lecture
- `candidateCount() ‚Üí uint256` : nombre total de candidats  
- `getCandidate(uint256 id) ‚Üí (string name, uint256 votes)` : d√©tail d‚Äôun candidat  
- `getCandidates() ‚Üí string[]` : liste des noms des candidats  
- `getVotes() ‚Üí uint256[]` : tableau des compteurs de votes  
- `winningCandidate() ‚Üí (uint256 id, string name, uint256 votes)` : candidat en t√™te  
- `hasVoted(address) ‚Üí bool` : indique si une adresse a vot√©  

#### √âcriture
- `addCandidate(string name)` : ajoute un candidat (**seulement en phase Setup**)  
- `openVoting()` : passe de **Setup ‚Üí Voting** (admin uniquement)  
- `closeVoting()` : passe de **Voting ‚Üí Ended** (admin uniquement)  
- `vote(uint256 candidateId)` : permet √† un √©lecteur de voter une fois pour un candidat existant (**en phase Voting uniquement**)  

---

### Invariants et r√®gles

- Impossible de voter hors phase **Voting**  
- `candidateId` doit √™tre valide (`candidateId < candidates.length`)  
- Une adresse ne peut voter **qu‚Äôune seule fois** (contr√¥le via `hasVoted`)  
- Les r√©sultats (`getVotes`, `winningCandidate`) sont accessibles **en temps r√©el**  

---

### S√©curit√© et extensibilit√©

#### S√©curit√©
- Aucun stockage ni transfert d‚ÄôETH  
- Pas d‚Äôappels externes dans `vote()` ‚Üí pas de r√©entrance  
- Solidity ‚â• 0.8 ‚Üí protection native contre overflow/underflow  

#### Transparence
- √âv√©nements pour tracer toutes les √©tapes  
- Lecture on-chain des r√©sultats et du statut des √©lecteurs  

#### Facilit√© d‚Äôusage
- Identifiants simples (entiers)  
- Lecture claire de l‚Äô√©tat du scrutin  

#### Extensions possibles
- **Meta-transactions / relayer (EIP-712)** : voter sans payer de gas  
- **Fen√™tre temporelle** : ouverture/fermeture automatique avec timestamps  
- **Commit-Reveal** : renforcer l‚Äôanonymat du vote  

---

### Logique Anti-Double-Vote

1. **Registre d‚Äô√©lecteurs** : chaque adresse est associ√©e √† un statut indiquant si elle a d√©j√† vot√©  
2. **V√©rification pr√©alable** : avant d‚Äôaccepter un vote, le contrat v√©rifie `hasVoted[msg.sender]`  
3. **Blocage du second vote** : si l‚Äôadresse a d√©j√† vot√© ‚Üí transaction rejet√©e  
4. **Marquage imm√©diat** : d√®s qu‚Äôun vote est accept√©, l‚Äôadresse est marqu√©e comme **a vot√©**  
5. **Immuabilit√©** : le statut ne peut √™tre r√©initialis√© ni modifi√©  

> Cette logique garantit qu‚Äôun √©lecteur ne peut voter **qu‚Äôune seule fois**, m√™me en cas de tentative de fraude ou de r√©ex√©cution.  

---

### M√©thodes publiques

#### Administration (r√©serv√©es au propri√©taire)
- **Initialiser les candidats** : enregistrer la liste des candidats (ex: *Amadou, Demba, Omar*)  
- **Ouvrir le scrutin** : autoriser le d√©marrage du vote  
- **Clore le scrutin** : mettre fin au vote et bloquer toute nouvelle participation  

#### Participation (√©lecteurs)
- **Voter** : choisir un candidat (si scrutin ouvert et adresse non encore utilis√©e)  

#### Consultation (tout public)
- **Consulter les r√©sultats** : nombre de voix obtenues par chaque candidat  
- **Consulter l‚Äô√©tat d‚Äôun √©lecteur** : v√©rifier si une adresse a d√©j√† vot√©  
- **Consulter l‚Äô√©tat du scrutin** : indiquer si le scrutin est **Setup / Voting / Ended**  
